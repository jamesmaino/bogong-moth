source("/Volumes/T7/bogong-moth/run_simulations.R", encoding = "UTF-8")
data = reg_codes, aes(lon, lat, label = REG_CODE_7),
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            data = reg_codes, aes(lon, lat, label = REG_CODE_7), 
            alpha = 0.3,
            color = "white",     # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15          # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
plot_title = plot_name
trap_sites <- sims %>%
        filter(step == 1) %>%
        group_by(lon_i, lat_i) %>%
        summarise(n = n()) %>%
        st_as_sf(coords = c("lon_i", "lat_i"), crs = 4326)
# grid_sum <- sims %>%
    #     filter(hour_along == -DURATION) %>%
    #     mutate(
    #         grid_x = round_to_increment(lon, grid_size),
    #         grid_y = round_to_increment(lat, grid_size)
    #     ) %>%
    #     group_by(grid_x, grid_y) %>%
    #     summarise(
    #         count = n(),
    #         .groups = "drop"
    #     ) %>%
    #     st_as_sf(coords = c("grid_x", "grid_y"), crs = 4326)
    bioreg_sum <- sims %>%
        filter(hour_along == -DURATION) %>%
        group_by(REG_NAME_7, REG_CODE_7) %>%
        summarise(
            count = n(),
            .groups = "drop"
        ) %>%
        right_join(shp[, c("REG_NAME_7", "REG_CODE_7")]) %>%
        st_as_sf()
shp <- st_make_valid(st_read("./data/IBRA/IBRA7_regions/ibra7_regions.shp"))
sims <- sims %>%
        st_as_sf(coords = c("lon", "lat"), crs = 4326, remove = FALSE) %>%
        st_transform(crs = st_crs(shp)) %>%
        st_make_valid() %>%
        st_join(shp) %>%
        st_set_geometry(NULL)
plot_name = "all"
trap_sites <- sims %>%
        filter(step == 1) %>%
        group_by(lon_i, lat_i) %>%
        summarise(n = n()) %>%
        st_as_sf(coords = c("lon_i", "lat_i"), crs = 4326)
# grid_sum <- sims %>%
    #     filter(hour_along == -DURATION) %>%
    #     mutate(
    #         grid_x = round_to_increment(lon, grid_size),
    #         grid_y = round_to_increment(lat, grid_size)
    #     ) %>%
    #     group_by(grid_x, grid_y) %>%
    #     summarise(
    #         count = n(),
    #         .groups = "drop"
    #     ) %>%
    #     st_as_sf(coords = c("grid_x", "grid_y"), crs = 4326)
    bioreg_sum <- sims %>%
        filter(hour_along == -DURATION) %>%
        group_by(REG_NAME_7, REG_CODE_7) %>%
        summarise(
            count = n(),
            .groups = "drop"
        ) %>%
        right_join(shp[, c("REG_NAME_7", "REG_CODE_7")]) %>%
        st_as_sf()
bioreg_sum %>%
        st_set_geometry(NULL) %>%
        write_csv(paste0("./results/plots/origin/", plot_name, ".csv"))
reg_codes <- bioreg_sum %>%
        st_centroid() %>%
        mutate(
            lon = st_coordinates(.)[, 1],
            lat = st_coordinates(.)[, 2]
        ) %>%
        st_drop_geometry()
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            data = reg_codes, aes(lon, lat, label = REG_CODE_7), 
            alpha = 0.3,
            color = "white",     # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15          # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
plot_title = plot_name
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            data = reg_codes, aes(lon, lat, label = REG_CODE_7), 
            alpha = 0.3,
            color = "white",     # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15          # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            data = reg_codes, aes(lon, lat, label = REG_CODE_7), 
            alpha = 0.3,
            color = "white",     # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15          # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            data = reg_codes, aes(lon, lat, label = REG_CODE_7), 
            color = "white",     # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15          # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            size=1,
            data = reg_codes, aes(lon, lat, label = REG_CODE_7),
            color = "white", # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15 # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            size=5,
            data = reg_codes, aes(lon, lat, label = REG_CODE_7),
            color = "white", # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15 # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
# ggplot() +
    #     geom_tile(data = grid_sum, aes(geometry = geometry, fill = count, height = grid_size, width = grid_size), stat = "sf_coordinates") +
    #     geom_sf(data = aus, color = "black", alpha = 0) +
    #     geom_point(data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
    #     coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
    #     ggtitle(plot_name, plot_title) +
    #     theme_bw() +
    #     scale_fill_viridis_c(begin = 0.2, end = 0.9, option = "A")
    ggsave(paste0("./results/plots/origin/", plot_name, ".png"), width = 8, height = 6)
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            size=3,
            data = reg_codes, aes(lon, lat, label = REG_CODE_7),
            color = "white", # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15 # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            size=3,
            data = reg_codes, aes(lon, lat, label = REG_CODE_7),
            color = "white", # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15 # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
ggplot() +
        # geom_sf(data = aus, color = "black", alpha = 0) +
        geom_sf(data = bioreg_sum, aes(fill = count), na.rm = TRUE) +
        geom_point(color = "white", data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        geom_point(shape = 21, data = trap_sites, aes(geometry = geometry), stat = "sf_coordinates") +
        coord_sf(xlim = c(135, 155), ylim = c(-25, -45)) +
        ggtitle(plot_name, plot_title) +
        theme_bw() +
        geom_text_repel(
            size=3,
            data = reg_codes, aes(lon, lat, label = REG_CODE_7),
            color = "white", # text color
            bg.color = "grey30", # shadow color
            bg.r = 0.15 # shadow radius
        ) +
        scale_fill_viridis_c(name = "Count", na.value = "white", begin = 0.2, end = 0.9, direction = -1, option = "A") +
        xlab("") +
        ylab("")
dev.off()
